<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Text Control Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    
    .section {
      margin-bottom: 30px;
    }
    
    .section h2 {
      color: #555;
      margin-bottom: 10px;
      font-size: 18px;
    }
    
    textarea {
      width: 100%;
      height: 100px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      resize: vertical;
    }
    
    button {
      background-color: #007cba;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    button:hover {
      background-color: #005a8b;
    }
    
    .queue-list {
      border: 1px solid #ddd;
      border-radius: 4px;
      min-height: 100px;
      padding: 10px;
      background-color: #fafafa;
    }
    
    .queue-item {
      background: white;
      padding: 8px;
      margin: 5px 0;
      border-radius: 4px;
      border-left: 4px solid #007cba;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .queue-item.active {
      border-left-color: #28a745;
      background-color: #e8f5e8;
    }
    
    .controls {
      margin-bottom: 20px;
    }
    
    .settings {
      display: flex;
      gap: 20px;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .settings label {
      font-weight: bold;
    }
    
    .settings input {
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 80px;
    }
    
    .status {
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 20px;
      font-weight: bold;
    }
    
    .status.playing {
      background-color: #e8f5e8;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status.stopped {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .slack-status {
      padding: 8px 12px;
      border-radius: 4px;
      margin-bottom: 15px;
      font-weight: bold;
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      color: #6c757d;
    }
    
    .slack-status.connected {
      background-color: #d4edda;
      color: #155724;
      border-color: #c3e6cb;
    }
    
    .slack-status.error {
      background-color: #f8d7da;
      color: #721c24;
      border-color: #f5c6cb;
    }
    
    .slack-config label {
      display: inline-block;
      width: 140px;
      font-weight: bold;
    }
    
    .slack-config input, .slack-config select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    #channelList {
      margin-top: 8px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 4px;
      min-height: 40px;
    }
    
    .channel-item {
      display: inline-block;
      background: #007cba;
      color: white;
      padding: 4px 8px;
      margin: 2px;
      border-radius: 12px;
      font-size: 12px;
      cursor: help;
    }
    
    .channel-item.unknown {
      background: #6c757d;
      font-style: italic;
    }
    
    .channel-item button {
      background: none;
      border: none;
      color: white;
      margin-left: 5px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .usage-guide {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .usage-guide h3 {
      margin: 0 0 10px 0;
      color: #495057;
    }
    
    .usage-guide ol {
      margin: 0;
      padding-left: 20px;
    }
    
    .usage-guide li {
      margin-bottom: 8px;
    }
    
    .usage-guide ul {
      margin: 5px 0 0 0;
      padding-left: 20px;
    }
    
    .usage-guide ul li {
      margin-bottom: 3px;
    }
    
    .usage-guide a {
      color: #007cba;
      text-decoration: none;
    }
    
    .usage-guide a:hover {
      text-decoration: underline;
    }
    
    .usage-guide code {
      background: #e9ecef;
      padding: 2px 4px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    
    .debug-info {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .debug-info h4 {
      margin: 0 0 10px 0;
      color: #495057;
    }
    
    #debugLog {
      background: #000;
      color: #0f0;
      padding: 10px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    
    /* æ–°ã—ã„UIç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .setup-wizard {
      margin-bottom: 30px;
    }
    
    .welcome-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .welcome-card h2 {
      margin: 0 0 15px 0;
      font-size: 28px;
    }
    
    .welcome-card p {
      margin: 0 0 30px 0;
      font-size: 16px;
      opacity: 0.9;
    }
    
    .setup-steps {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 30px;
    }
    
    .step-item {
      display: flex;
      align-items: flex-start;
      gap: 20px;
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 10px;
      backdrop-filter: blur(10px);
    }
    
    .step-number {
      background: #fff;
      color: #667eea;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
      flex-shrink: 0;
    }
    
    .step-content h3 {
      margin: 0 0 8px 0;
      font-size: 18px;
    }
    
    .step-content p {
      margin: 0 0 15px 0;
      opacity: 0.9;
    }
    
    .step-button {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 2px solid rgba(255,255,255,0.3);
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .step-button:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
    }
    
    .dashboard {
      margin-bottom: 30px;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .status-card, .slack-card, .controls-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .status-card:hover, .slack-card:hover, .controls-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .status-card h3, .slack-card h3, .controls-card h3 {
      margin: 0 0 15px 0;
      color: #333;
      font-size: 16px;
    }
    
    .queue-count {
      margin-top: 10px;
      color: #666;
      font-size: 14px;
    }
    
    .watched-summary {
      margin-top: 10px;
      color: #666;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .small-btn {
      background: #f0f0f0;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.2s ease;
    }
    
    .small-btn:hover {
      background: #e0e0e0;
    }
    
    .quick-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .control-btn {
      flex: 1;
      min-width: 70px;
      padding: 10px 8px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    
    .control-btn.primary {
      background: #28a745;
      color: white;
    }
    
    .control-btn.primary:hover {
      background: #218838;
      transform: translateY(-1px);
    }
    
    .control-btn:not(.primary):not(.danger) {
      background: #6c757d;
      color: white;
    }
    
    .control-btn:not(.primary):not(.danger):hover {
      background: #5a6268;
      transform: translateY(-1px);
    }
    
    .control-btn.danger {
      background: #dc3545;
      color: white;
    }
    
    .control-btn.danger:hover {
      background: #c82333;
      transform: translateY(-1px);
    }
    
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      cursor: pointer;
      user-select: none;
    }
    
    .section-header h2 {
      margin: 0;
    }
    
    .collapse-btn {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      padding: 5px;
      border-radius: 4px;
      transition: transform 0.2s ease, background 0.2s ease;
    }
    
    .collapse-btn:hover {
      background: rgba(0,0,0,0.1);
    }
    
    .collapse-btn.collapsed {
      transform: rotate(-90deg);
    }
    
    .section-content {
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    
    .section-content.collapsed {
      max-height: 0 !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“º ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h1>
    
    <!-- åˆå›è¨­å®šç”»é¢ -->
    <div class="setup-wizard" id="setupWizard" style="display: none;">
      <div class="welcome-card">
        <h2>ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¸ã‚ˆã†ã“ã</h2>
        <p>Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€éã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚</p>
        
        <div class="setup-steps">
          <div class="step-item">
            <div class="step-number">1</div>
            <div class="step-content">
              <h3>Slack Appã‚’ä½œæˆ</h3>
              <p>ã¾ãšã€Slackã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚</p>
              <button class="step-button" onclick="toggleSetupGuide()">ğŸ“– è©³ç´°ãªæ‰‹é †ã‚’è¦‹ã‚‹</button>
            </div>
          </div>
          
          <div class="step-item">
            <div class="step-number">2</div>
            <div class="step-content">
              <h3>ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›</h3>
              <p>å–å¾—ã—ãŸBot Tokenã¨App Tokenã‚’ä¸‹è¨˜ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
              <button class="step-button" onclick="scrollToTokenInput()">ğŸ”‘ ãƒˆãƒ¼ã‚¯ãƒ³å…¥åŠ›ã¸</button>
            </div>
          </div>
          
          <div class="step-item">
            <div class="step-number">3</div>
            <div class="step-content">
              <h3>ãƒãƒ£ãƒ³ãƒãƒ«é¸æŠ</h3>
              <p>ç›£è¦–ã—ãŸã„Slackãƒãƒ£ãƒ³ãƒãƒ«ã‚’é¸æŠã—ã¦å®Œäº†ã§ã™ã€‚</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- é€šå¸¸é‹ç”¨ç”»é¢ -->
    <div class="dashboard" id="dashboard" style="display: none;">
      <div class="dashboard-grid">
        <div class="status-card">
          <h3>ğŸ¬ å†ç”ŸçŠ¶æ…‹</h3>
          <div class="status stopped" id="status">åœæ­¢ä¸­</div>
          <div class="queue-count">ã‚­ãƒ¥ãƒ¼: <span id="queueCount">0</span>ä»¶</div>
        </div>
        
        <div class="slack-card">
          <h3>ğŸ’¬ Slacké€£æº</h3>
          <div class="slack-status connected" id="slackStatus">æ¥ç¶šä¸­</div>
          <div class="watched-summary">
            ç›£è¦–ä¸­: <span id="channelCount">0</span>ãƒãƒ£ãƒ³ãƒãƒ«
            <button class="small-btn" onclick="showSlackSettings()">âš™ï¸ è¨­å®š</button>
          </div>
        </div>
        
        <div class="controls-card">
          <h3>ğŸ® ã‚¯ã‚¤ãƒƒã‚¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h3>
          <div class="quick-controls">
            <button id="quickStartBtn" class="control-btn primary">â–¶ï¸ å†ç”Ÿ</button>
            <button id="quickStopBtn" class="control-btn">â¹ï¸ åœæ­¢</button>
            <button id="quickClearBtn" class="control-btn danger">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="section slack-settings" id="slackSettings">
      <div class="section-header">
        <h2>ğŸ’¬ Slacké€£æºè¨­å®š</h2>
        <button class="collapse-btn" id="slackCollapseBtn" onclick="toggleSlackSettings()">â–¼</button>
      </div>
      <div class="section-content" id="slackContent">
      
      <div class="usage-guide">
        <h3>ğŸ”§ è¨­å®šæ‰‹é †</h3>
        <ol>
          <li><strong>Slack Appã‚’ä½œæˆ</strong>
            <ul>
              <li><a href="https://api.slack.com/apps" target="_blank">api.slack.com/apps</a> ã§ã‚¢ãƒ—ãƒªã‚’ä½œæˆ</li>
              <li><strong>ã€ŒOAuth & Permissionsã€</strong>ã§ä»¥ä¸‹ã®Bot Token Scopesã‚’è¿½åŠ :
                <ul>
                  <li><code>channels:read</code> - ãƒãƒ£ãƒ³ãƒãƒ«ä¸€è¦§å–å¾—</li>
                  <li><code>groups:read</code> - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒ£ãƒ³ãƒãƒ«èª­ã¿å–ã‚Š</li>
                  <li><code>channels:history</code> - ãƒãƒ£ãƒ³ãƒãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èª­ã¿å–ã‚Š</li>
                  <li><code>users:read</code> - ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±èª­ã¿å–ã‚Š</li>
                </ul>
              </li>
              <li><strong>ã€ŒSocket Modeã€</strong>ã‚’æœ‰åŠ¹åŒ–ã—ã¦App Tokenã‚’ç”Ÿæˆ</li>
              <li><strong>ã€ŒEvent Subscriptionsã€</strong>ã‚’æœ‰åŠ¹åŒ–:
                <ul>
                  <li>ã€ŒEnable Eventsã€ã‚’ONã«ã™ã‚‹</li>
                  <li>ã€ŒSubscribe to bot eventsã€ã§ä»¥ä¸‹ã‚’è¿½åŠ :</li>
                  <li><code>message.channels</code> - ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ âš ï¸å¿…é ˆ</li>
                  <li><code>message.groups</code> - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ âš ï¸å¿…é ˆ</li>
                  <li><code>message.im</code> - ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰</li>
                </ul>
              </li>
              <li>ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</li>
              <li>Bot Token (xoxb-) ã¨ App Token (xapp-) ã‚’å–å¾—</li>
            </ul>
          </li>
          <li><strong>ã‚¢ãƒ—ãƒªã«æ¥ç¶š</strong>: ä¸Šè¨˜ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›ã—ã€ŒSlackæ¥ç¶šã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
          <li><strong>ãƒãƒ£ãƒ³ãƒãƒ«ç›£è¦–</strong>: ç›£è¦–ã—ãŸã„ãƒãƒ£ãƒ³ãƒãƒ«ã‚’é¸æŠã—ã€Œãƒãƒ£ãƒ³ãƒãƒ«è¿½åŠ ã€</li>
          <li><strong>è‡ªå‹•è¡¨ç¤º</strong>: ã€Œè‡ªå‹•è¿½åŠ : ONã€ã§Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè‡ªå‹•ã§ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã•ã‚Œã‚‹</li>
        </ol>
      </div>
      
      <div class="slack-status" id="slackStatus">
        æœªæ¥ç¶š
      </div>
      
      <div class="debug-info" id="debugInfo" style="display: none;">
        <h4>ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h4>
        <div id="debugLog"></div>
        <button onclick="clearDebugLog()" style="margin-top: 10px;">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        <button onclick="toggleDebug()" style="margin-top: 10px;">ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºåˆ‡æ›¿</button>
      </div>
      <div class="slack-config">
        <div style="margin-bottom: 15px;">
          <label for="botToken">Bot Token (xoxb-):</label>
          <input type="password" id="botToken" placeholder="xoxb-your-bot-token" style="width: 300px;">
        </div>
        <div style="margin-bottom: 15px;">
          <label for="appToken">App Token (xapp-):</label>
          <input type="password" id="appToken" placeholder="xapp-your-app-token" style="width: 300px;">
        </div>
        <div style="margin-bottom: 15px;">
          <label for="channelSearch">ãƒãƒ£ãƒ³ãƒãƒ«æ¤œç´¢:</label>
          <input type="text" id="channelSearch" placeholder="ãƒãƒ£ãƒ³ãƒãƒ«åã§æ¤œç´¢..." style="width: 200px;" disabled>
          <button id="loadChannelsBtn" disabled style="margin-left: 10px;">ãƒãƒ£ãƒ³ãƒãƒ«ä¸€è¦§å–å¾—</button>
        </div>
        <div style="margin-bottom: 15px;">
          <label for="channelSelect">ç›£è¦–ãƒãƒ£ãƒ³ãƒãƒ«:</label>
          <select id="channelSelect" style="width: 300px;" disabled size="8">
            <option value="">å…ˆã«Slackã«æ¥ç¶šã—ã¦ãã ã•ã„</option>
          </select>
        </div>
        <div class="controls">
          <button id="connectSlackBtn">Slackæ¥ç¶š</button>
          <button id="disconnectSlackBtn">åˆ‡æ–­</button>
          <button id="addChannelBtn">ãƒãƒ£ãƒ³ãƒãƒ«è¿½åŠ </button>
          <button id="slackAutoBtn">è‡ªå‹•è¿½åŠ : OFF</button>
          <button id="autoConnectBtn">èµ·å‹•æ™‚è‡ªå‹•æ¥ç¶š: ON</button>
          <button id="saveConfigBtn">è¨­å®šä¿å­˜</button>
          <button id="clearConfigBtn" style="background: #dc3545;">è¨­å®šã‚¯ãƒªã‚¢</button>
          <button onclick="toggleDebug()" style="background: #6c757d;">ãƒ‡ãƒãƒƒã‚°è¡¨ç¤º</button>
        </div>
        <div id="watchedChannels" style="margin-top: 15px;">
          <strong>ç›£è¦–ä¸­ã®ãƒãƒ£ãƒ³ãƒãƒ«:</strong>
          <div id="channelList">ãªã—</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ </h2>
      <textarea id="newText" placeholder="è¡¨ç¤ºã—ãŸã„ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
      <div class="controls">
        <button id="addTextBtn">ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ </button>
        <button id="addAndStartBtn">è¿½åŠ ã—ã¦å†ç”Ÿé–‹å§‹</button>
      </div>
    </div>
    
    <div class="section">
      <h2>è¡¨ç¤ºè¨­å®š</h2>
      <div class="settings">
        <label for="displayTime">è¡¨ç¤ºæ™‚é–“:</label>
        <input type="number" id="displayTime" value="3" min="1" max="60">
        <span>ç§’</span>
        
        <label for="fadeTime">ãƒ•ã‚§ãƒ¼ãƒ‰æ™‚é–“:</label>
        <input type="number" id="fadeTime" value="0.5" min="0" max="5" step="0.1">
        <span>ç§’</span>
      </div>
    </div>
    
    <div class="section">
      <h2>å†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>
      <div class="controls">
        <button id="startQueueBtn">å†ç”Ÿé–‹å§‹</button>
        <button id="stopQueueBtn">åœæ­¢</button>
        <button id="nextTextBtn">æ¬¡ã¸ã‚¹ã‚­ãƒƒãƒ—</button>
        <button id="clearQueueBtn">ã‚­ãƒ¥ãƒ¼ã‚’ã‚¯ãƒªã‚¢</button>
      </div>
    </div>
    
    <div class="section">
      <h2>ãƒ†ã‚­ã‚¹ãƒˆã‚­ãƒ¥ãƒ¼</h2>
      <div class="queue-list" id="queueList">
        ã‚­ãƒ¥ãƒ¼ã¯ç©ºã§ã™
      </div>
    </div>
  </div>

  <script src="control.js"></script>
</body>
</html>